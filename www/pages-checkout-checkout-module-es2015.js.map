{"version":3,"sources":["./src/app/pages/checkout/checkout.page.scss","./src/app/pages/checkout/checkout.page.ts","./src/app/pages/checkout/checkout-routing.module.ts","./src/app/pages/checkout/checkout.module.ts","./src/app/pages/checkout/checkout.page.html"],"names":[],"mappings":"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","file":"pages-checkout-checkout-module-es2015.js","sourcesContent":["export default \".StripeElement {\\n  padding: 20px 20px;\\n}\\n\\n.StripeElement--webkit-autofill {\\n  background-color: #fefde5 !important;\\n}\\n\\n#card-errors {\\n  text-align: center;\\n  color: var(--ion-color-danger);\\n  margin: 10px;\\n}\\n/*# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL2NoZWNrb3V0LnBhZ2Uuc2NzcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtFQUNFLGtCQUFBO0FBQ0Y7O0FBRUE7RUFDRSxvQ0FBQTtBQUNGOztBQUVBO0VBQ0Usa0JBQUE7RUFDQSw4QkFBQTtFQUNBLFlBQUE7QUFDRiIsImZpbGUiOiJjaGVja291dC5wYWdlLnNjc3MiLCJzb3VyY2VzQ29udGVudCI6WyIuU3RyaXBlRWxlbWVudCB7XG4gIHBhZGRpbmc6IDIwcHggMjBweDtcbn1cbiBcbi5TdHJpcGVFbGVtZW50LS13ZWJraXQtYXV0b2ZpbGwge1xuICBiYWNrZ3JvdW5kLWNvbG9yOiAjZmVmZGU1ICFpbXBvcnRhbnQ7XG59XG4gXG4jY2FyZC1lcnJvcnMge1xuICB0ZXh0LWFsaWduOiBjZW50ZXI7XG4gIGNvbG9yOiB2YXIoLS1pb24tY29sb3ItZGFuZ2VyKTtcbiAgbWFyZ2luOiAxMHB4O1xufSJdfQ== */\";","import { taggedTemplate } from '@angular/compiler/src/output/output_ast';\nimport { Component, ElementRef, OnInit, ViewChild } from '@angular/core';\nimport { FormGroup, FormBuilder, Validators } from '@angular/forms';\nimport { Router } from '@angular/router';\nimport { LoadingController, ToastController } from '@ionic/angular';\nimport { AuthService } from 'src/app/services/auth.service';\nimport { CartService } from 'src/app/services/cart.service';\nimport { ProductService } from 'src/app/services/product.service';\nimport { environment } from 'src/environments/environment';\n\n//Variable for using STRIPE (payments)\ndeclare var Stripe;\n\n@Component({\n  selector: 'app-checkout',\n  templateUrl: './checkout.page.html',\n  styleUrls: ['./checkout.page.scss'],\n})\nexport class CheckoutPage implements OnInit {\n\n  dataForm: FormGroup;\n  cart = [];\n  \n  //Variables for using STRIPE (payments method)\n  stripe;\n  card;\n  cardErrors;\n\n  //Viewchild in order to use the cardElement in the HTML page of the checkout\n  @ViewChild('cardElement', {static: true}) cardElement: ElementRef;\n\n  constructor(\n    private _loadingCtrl: LoadingController,\n    private _fb: FormBuilder,\n    private _authService: AuthService,\n    private _productService: ProductService,\n    private _toastCtrl: ToastController,\n    private _cartService: CartService,\n    private _router: Router\n  ) {}\n \n  ngOnInit() {\n    this._cartService.getCart().subscribe(res => {\n      this.cart = res;\n    });\n \n    this.dataForm = this._fb.group({\n      name: ['Daniel DomÃ­nguez', Validators.required],\n      zip: ['17004', Validators.required],\n      street: ['Avenida Girona', Validators.required],\n      city: ['Girona', Validators.required],\n      country: ['ES', Validators.required]\n    });\n\n    //Stripe Settings, passing the stripe_key which is allocated in the environment file.\n    this.stripe = Stripe(environment.stripe_key);\n    const elements = this.stripe.elements();\n\n    //Card element which captures the input\n    this.card = elements.create('card');\n    this.card.mount(this.cardElement.nativeElement);\n\n    this.card.addEventListener('card changes: ', ({error}) => {\n      console.log('error:', error);\n      this.cardErrors = error && error.message;\n    });\n \n  }\n \n  getTotal() {\n    return this.cart.reduce((i, j) => i + j.itemPrice * j.amount, 0);\n  }\n \n  async buyNow(){\n\n    const stripeData = {\n      payment_method_data: {\n        billing_details: {\n          name: this.dataForm.get('name').value,\n          address: {\n            line1: this.dataForm.get('street').value,\n            city: this.dataForm.get('city').value,\n            postal_code: this.dataForm.get('zip').value,\n            country: this.dataForm.get('country').value\n          },\n          email: this._authService.getEmail()\n        }\n      },\n      receipt_email: this._authService.getEmail()\n    };\n\n    //mapping to get from our cart all the items with id and amount\n    const items = this.cart.map(item => {\n      return {\n        id: item.id,\n        amount: item.amount\n      };\n    })\n\n    //Loading animation after purchase order\n    const loading = await this._loadingCtrl.create();\n    await loading.present();\n\n    // the * 100 is to get the right number in stripe\n    this._productService.startPaymentIntent(this.getTotal() * 100,items)\n    .subscribe(async paymentIntent => {\n    console.log('my payment intent: ', paymentIntent);\n    const secret = paymentIntent.client_secret;\n\n    // This allows us to send the secret which identifies the payment intent, the credit card info and stripe data\n    const {result, err} = await this.stripe.handleCardPayment(\n      secret,\n      this.card,\n      stripeData\n    );\n\n    console.log('Result of handleCardPayment; ', result);\n\n    //error message in case payment could not be Fulfilled, toaster appears for 3 seconds\n    if(err){\n      await loading.dismiss();\n      const toast = await this._toastCtrl.create({\n        message: `Could not process your payment, please try again later`,\n        duration: 3000\n      });\n      await toast.present();\n    } else {\n      await loading.dismiss();\n      const toast = await this._toastCtrl.create({\n        message: `Could not process your payment, please try again later`,\n        duration: 3000\n      });\n      await toast.present();\n      this._router.navigateByUrl('/tabs/tab2');\n    }\n    }, async err => {\n      await loading.dismiss();\n      const toast = await this._toastCtrl.create({\n        message: `Could not process your payment, please try again later`,\n        duration: 3000\n      });\n      await toast.present();\n    });\n  }\n\n}","import { NgModule } from '@angular/core';\nimport { Routes, RouterModule } from '@angular/router';\n\nimport { CheckoutPage } from './checkout.page';\n\nconst routes: Routes = [\n  {\n    path: '',\n    component: CheckoutPage\n  }\n];\n\n@NgModule({\n  imports: [RouterModule.forChild(routes)],\n  exports: [RouterModule],\n})\nexport class CheckoutPageRoutingModule {}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\n\nimport { IonicModule } from '@ionic/angular';\n\nimport { CheckoutPageRoutingModule } from './checkout-routing.module';\n\nimport { CheckoutPage } from './checkout.page';\n\n\n@NgModule({\n  imports: [\n    CommonModule,\n    FormsModule,\n    IonicModule,\n    CheckoutPageRoutingModule,\n    ReactiveFormsModule\n  ],\n  declarations: [CheckoutPage]\n})\nexport class CheckoutPageModule {}\n","export default \"<ion-header>\\n  <ion-toolbar color=\\\"primary\\\">\\n    <ion-buttons slot=\\\"start\\\">\\n      <ion-back-button defaultHref=\\\"/tabs/tab2\\\"></ion-back-button>\\n    </ion-buttons>\\n    <ion-title>Checkout</ion-title>\\n  </ion-toolbar>\\n</ion-header>\\n \\n<ion-content>\\n \\n  <form [formGroup]=\\\"dataForm\\\" (submit)=\\\"buyNow()\\\">\\n    <ion-item>\\n      <ion-label position=\\\"stacked\\\">Name</ion-label>\\n      <ion-input formControlName=\\\"name\\\"></ion-input>\\n    </ion-item>\\n    <ion-item>\\n      <ion-label position=\\\"stacked\\\">Street</ion-label>\\n      <ion-input formControlName=\\\"street\\\"></ion-input>\\n    </ion-item>\\n    <ion-item>\\n      <ion-label position=\\\"stacked\\\">City</ion-label>\\n      <ion-input formControlName=\\\"city\\\"></ion-input>\\n    </ion-item>\\n    <ion-item>\\n      <ion-label position=\\\"stacked\\\">ZIP</ion-label>\\n      <ion-input formControlName=\\\"zip\\\"></ion-input>\\n    </ion-item>\\n    <ion-item>\\n      <ion-label position=\\\"stacked\\\">Country</ion-label>\\n      <ion-input formControlName=\\\"country\\\"></ion-input>\\n    </ion-item>\\n \\n    <div #cardElement></div>\\n \\n    <div id=\\\"card-errors\\\" role=\\\"alert\\\">\\n      {{ cardErrors}}\\n    </div>\\n \\n    <ion-button expand=\\\"full\\\" type=\\\"submit\\\" [disabled]=\\\"!dataForm.valid\\\">Purchase order :  {{ getTotal() | currency:'EUR'}}</ion-button>\\n  </form>\\n \\n</ion-content>\";"],"sourceRoot":"webpack:///"}